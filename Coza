import { ApiError } from "../utils/ApiError.js";
import { uploadOnCloudinary } from "../utils/cloudinary.js";
import Product from '../models/product.js';
import Category from '../models/category.js'; // Ensure the Category model is imported

// Create Product Function
const createProduct = asyncHandler(async (req, res) => {
  try {
    const { name, price, categoryId } = req.body;

    // Check if category exists
    const category = await Category.findById(categoryId);
    if (!category) {
      return res.json(new ApiResponse(404, "Category not found"));
    }

    // Uploading the image on cloudinary
    const imagePath = req.files?.coverImage?.[0]?.path || null;
    const Image = await uploadOnCloudinary(imagePath);

    const product = new Product({
      name,
      price,
      category: category._id, // Use the category ID
      coverImage: Image?.url || "",
    });

    await product.save();

    res.json(new ApiResponse(201, "Product created successfully", product));
  } catch (error) {
    console.log("Error in creating product", error);
    throw new ApiError(500, "Something went wrong while creating product");
  }
});