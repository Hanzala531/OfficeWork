<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link rel="stylesheet" href="../styles/style.css" />
    <style>/* Popup and Overlay Styles */
      .popupDiv {
        display: none; /* Hide the popup by default */
        /* padding-right: -200px; */
      }
      
      .popupDiv.active {
        display: block; /* Show the popup when active */
      }
      
      .overlay {
        position: fixed;
        /* border: 2px  solid #030405; */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
        backdrop-filter: blur(5px); /* Blur effect */
        z-index: 999; /* Ensure it's above other content */
      }
      
      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        /* background:  white; */
        opacity: 0.689;
        backdrop-filter: blur(200px);
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
        width: 400px;
        max-width: 90%;
        z-index: 1000; /* Ensure it's above the overlay */
      }
      
      .popup h2 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #111827;
      }
      
      .popup input,
      .popup textarea,
      .popup select {
        width: 100%;
        margin-bottom: 1rem;
        padding: 0.75rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.875rem;
        color: #374151;
        opacity: 0.5;
        backdrop-filter: blur(200px);
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      
      .popup input:focus,
      .popup textarea:focus,
      .popup select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .popup textarea {
        resize: vertical;
        min-height: 100px;
      }
      
      .popup button {
        width: 100%;
        padding: 0.75rem;
        border: none;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      
      .popup button.create {
        background-color: #3b82f6;
        opacity: 0.4;
        color: white;
        margin-bottom: 0.5rem;
      }
      
      .popup button.create:hover {
        background-color: #2563eb;
        color: #111827;
      }
      
      .popup button.cancel {
        background-color: #f9fafb;
        color: #374151;
        border: 1px solid #e5e7eb;
      }
      
      .popup button.cancel:hover {
        background-color: #f3f4f6;
      }
      
      .popup .file-input {
        margin-bottom: 1rem;
      }
      
      .popup .file-input input[type="file"] {
        display: none;
      }
      
      .popup .file-input label {
        display: block;
        padding: 0.75rem;
        border: 1px dashed #e5e7eb;
        border-radius: 8px;
        text-align: center;
        color: #d0d3d8;
        cursor: pointer;
        transition: border-color 0.2s, background-color 0.2s;
      }
      
      .popup .file-input label:hover {
        border-color: #3b82f6;
        background-color: #323335;
      }</style>
  </head>
  <body>
    <div class="admin-container">
      <aside class="sidebar">
        <div>
          <h2>Admin Panel</h2>
          <ul>
            <li><a href="#products">Products</a></li>
            <li><a href="#orders">Orders</a></li>
            <li><a href="#users">Users</a></li>
            <li><a href="#newsLetter">Subscribers</a></li>
          </ul>
        </div>
        <button class="logout-btn" id="logout">Logout</button>
      </aside>
      <main class="content">
        <button id="theme-toggle">Dark Mode</button>
        <header>
          <h1>Welcome to Admin Panel</h1>
        </header>
        <section id="products">
          <h2>Manage Products</h2>
          <button id="addProduct">Add Product</button>
          <!-- Popup Structure -->
          <div class="popupDiv">
            <div class="overlay" id="overlay"></div>
          <div class="popup" id="popup">
            <h2>Create Product</h2>
            <input type="text" id="name" placeholder="Product Name" />
            <input type="number" id="price" placeholder="Price" />
            <input type="text" id="category" placeholder="Category" />
            <textarea id="description" placeholder="Description"></textarea>
            <input type="number" id="stock" placeholder="Stock" />
            <div class="file-input">
              <input type="file" id="image" />
              <label for="image" class="cretBtn">Upload Product Image</label>
              <span id="file-name-display" style="display: none;"></span> <!-- Add this line -->
            </div>
            <button class="create" id="submitProduct">Create</button>
            <button class="cancel" onclick="closePopup()">Cancel</button>
          </div>
          </div>
          <table border="1" id="productTable">
            <tr>
              <th width="26%">Product Name</th>
              <th width="16%">Price</th>
              <th width="16%">Category</th>
              <th width="17%">Stocks</th>
              <th width="21%">Actions</th>
            </tr>
          </table>
        </section>
        <section id="orders">
          <h2>Manage Orders</h2>
          <table border="1" id="orderTable">
            <tr>
              <th width="26%">Order ID</th>
              <th>Price</th>
              <th width="22%">Status</th>
              <th width="22%">Actions</th>
            </tr>
          </table>
        </section>
        <section id="users">
          <h2>Manage Users</h2>
          <table border="1" id="userTable">
            <tr>
              <th width="26%">User Name</th>
              <th>Email</th>
              <th width="22%">Status</th>
              <th width="22%">Actions</th>
            </tr>
          </table>
        </section>
        <section id="newsLetter">
          <h2>Subscribers</h2>
          <table border="1" id="newsLetterTable">
            <tr>
              <th width="26%">Subscriber No</th>
              <th>Email Address</th>
              <th width="22%">Actions</th>
            </tr>
          </table>
        </section>
      </main>
    </div>
    <script>document.addEventListener("DOMContentLoaded", () => {
      // Add event listener to the "Add Product" button
      document.getElementById('addProduct').addEventListener('click', () => {
        openPopup(); // Open the popup
      });
    
      // Add event listener to the "Submit" button in the popup
      document.getElementById('submitProduct').addEventListener('click', async () => {
        await submitProduct(); // Handle form submission
      });
    });
    // Add event listener to the file input
document.getElementById('image').addEventListener('change', (event) => {
  const fileInput = event.target;
  const fileNameDisplay = document.getElementById('file-name-display');

  if (fileInput.files.length > 0) {
    // Get the selected file name
    const fileName = fileInput.files[0].name;

    // Display the file name
    fileNameDisplay.textContent = `Selected file: ${fileName}`;
    fileNameDisplay.style.display = 'block'; // Show the file name display
  } else {
    fileNameDisplay.style.display = 'none'; // Hide the file name display if no file is selected
  }
});
    
    // Function to open the popup
    function openPopup() {
      const popupDiv = document.querySelector('.popupDiv');
      popupDiv.classList.add('active'); // Show the popup and overlay
      document.body.style.overflow = 'hidden';

    }
    
    // Function to close the popup
    function closePopup() {
      const popupDiv = document.querySelector('.popupDiv');
      popupDiv.classList.remove('active'); // Hide the popup and overlay
      document.body.style.overflow = 'scroll';

    }
    
    // Function to handle form submission
    async function submitProduct() {
    const name = document.getElementById('name').value.trim();
    const price = document.getElementById('price').value.trim();
    const category = document.getElementById('category').value.trim();
    const description = document.getElementById('description').value.trim();
    const stock = document.getElementById('stock').value.trim();
    const coverImage = document.getElementById('image').files[0];

    if (!name || !price || !category || !description || !stock || !coverImage) {
        alert('Please fill all fields and upload an image.');
        return;
    }

    const formData = new FormData();
    formData.append('name', name);
    formData.append('price', price);
    formData.append('category', category);
    formData.append('description', description);
    formData.append('stock', stock);
    formData.append('coverImage', coverImage); // Ensure this matches your backend field


        const response = await fetch('http://localhost:3000/api/v1/products/create', {
            method: 'POST',
            body: formData // Do not set Content-Type manually
        });

       const data = await response.json(); // Read response body

if (!response.ok) {
    console.error('Server response:', response.status, data);
    throw new Error(`Failed to create product: ${data.message || 'Unknown error'}`);
}
        alert('Product created successfully!');
        closePopup();
   
}
    </script>  
    <script src="adminPannel.js"></script>
  </body>
</html>